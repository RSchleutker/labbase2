{% import 'macros/forms.html' as forms %}
{% import 'macros/modal.html' as modal %}


{% macro file_upload_form(form, endpoint, method, id, entity_id) %}

    {% if id == -1 %}
        {% set action = url_for(endpoint, entity_id=entity_id) %}
        {% set title = 'Upload File' %}
    {% else %}
        {% set action = url_for(endpoint, id_=id) %}
        {% set title = 'Edit File' %}
    {% endif %}

    {% set modal_id = 'modal-edit-file-' ~ id %}
    {% set form_id = 'form-edit-file-' ~ id %}

    {% call modal.modal(id=modal_id, title=title) %}

        <form action="{{ action }}" method="{{ method }}" enctype=multipart/form-data id="{{ form_id }}">

            {{ form.hidden_tag() }}

            <div class="row mb-3">
                {{ forms.field_row(form.file, 'File') }}
            </div>

            <div class="row mb-3">
                {{ forms.field_row(form.note, 'Note') }}
            </div>

            <div class="row mb-3">
                <div class="col-sm-10">
                    {{ form.submit() }}
                </div>
            </div>

        </form>

        <div id="{{ form_id }}-messages"></div>

    {% endcall %}

{% endmacro %}


{% macro file_edit_form(form, endpoint, method, id) %}

    <div id="modal-edit-file-{{ id }}"
         class="modal fade"
         role="dialog">
        <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Upload or Edit File</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;
                    </button>
                </div>
                <div class="modal-body" id="modal-edit-file-{{ id }}-body">

                    <div>

                        <div class="row">
                            <div class="col-12">

                                <form action="{{ url_for(endpoint, id_=id) }}"
                                      method="GET"
                                      enctype=multipart/form-data
                                      id="form-edit-file-{{ id }}">
                                    {{ form.hidden_tag() }}
                                    <div class="row">
                                        <div class="col-12">
                                            {{ forms.field_no_label(form.note) }}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        {{ form.submit() }}
                                    </div>
                                </form>

                                <div id="form-edit-file-{{ id }}-messages">

                                </div>

                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    {{ forms.script_send_form(
      form,
      'form-edit-file-' + id|string,
      method,
      'form-edit-file-' + id|string + '-messages'
      ) }}

{% endmacro %}